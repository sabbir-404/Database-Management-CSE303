
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin - Slaughterhouse Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <style>
    body { background-color: #f4f6f9; }
    .wrapper { display: flex; }
    .sidebar {
      width: 250px; height: 100vh; background: #343a40;
      color: white; padding: 20px 0; position: fixed;
      display: flex; flex-direction: column;
    }
    .sidebar .text-center { margin-bottom: 15px; }
    .sidebar a {
      padding: 12px 20px; color: #ccc; text-decoration: none;
      display: flex; align-items: center;
      border-left: 3px solid transparent;
    }
    .sidebar a:hover, .sidebar a.active {
      color: white; background-color: #495057;
      font-weight: bold; border-left: 3px solid #fff;
    }
    .dashboard-container {
      margin-left: 270px; padding: 30px; width: calc(100% - 270px);
    }
    .card { margin-bottom: 20px; }
    .top-btn {
      float: right;
      margin-top: -40px;
    }
    .action-buttons button {
      margin-right: 5px;
    }
  </style>
</head>
<body>
<div class="sidebar">
  <div class="text-center">
    <img src="Logo/Logo white.png" alt="Meat Grid Logo" style="max-width: 100px;">
  </div>
  <h5><i class="fas fa-tachometer-alt me-2"></i>Admin Panel</h5>
  <a href="admin-dashboard.html"><i class="fas fa-home me-2"></i>Dashboard</a>
  <a href="admin-farmers.html"><i class="fas fa-tractor me-2"></i>Farmer Data</a>
  <a href="admin-retailers.html"><i class="fas fa-store me-2"></i>Retailer Sales</a>
  <a href="admin-slaughter.html" class="active"><i class="fas fa-industry me-2"></i>Slaughterhouse Info</a>
</div>

<div class="dashboard-container container-fluid">
  <h2 class="mb-4">Slaughterhouse Dashboard</h2>

  <div class="card">
    <div class="card-body">
      <h5 class="card-title">Processed Meat Details</h5>
      <button class="btn btn-success btn-sm top-btn" onclick="addMeatRow()"><i class="fas fa-plus"></i> Add</button>
      <div class="table-responsive" style="max-height: 350px;">
        <table class="table table-bordered" id="meatTable">
          <thead class="table-dark">
            <tr>
              <th>Meat Type</th>
              <th>Breed</th>
              <th>Slaughterhouse Name</th>
              <th>Slaughterhouse ID</th>
              <th>Weight (kg)</th>
              <th>Processed Date</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="meatBody">
            <!-- Dynamic rows -->
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="card-body">
      <h5 class="card-title">Total Meat Production Summary</h5>
      <div class="table-responsive">
        <table class="table table-bordered" id="summaryTable">
          <thead class="table-dark">
            <tr>
              <th>Meat Type</th>
              <th>Breed</th>
              <th>Storing Temperature (Â°C)</th>
              <th>Yield Weight (kg)</th>
            </tr>
          </thead>
          <tbody id="summaryBody">
            <!-- Linked summary from processed meat -->
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="card-body">
      <h5 class="card-title">Meat Quantity by Type</h5>
      <canvas id="meatBarChart" style="width: 100%; max-height: 300px;"></canvas>
    </div>
  </div>
</div>

<footer class="bg-dark text-white text-center p-3 mt-5">
  &copy; 2025 Meat Grid. All Rights Reserved.
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const meatTypes = ['T-Bone', 'Drumstick', 'Liver', 'Heart', 'Ribs', 'Thigh', 'Wing', 'Breast'];
const breeds = ['Local Cattle', 'Broiler', 'Black Bengal'];
const tempMap = { 'Local Cattle': 4, 'Broiler': 2, 'Black Bengal': 4 };

function createSelect(options, val = '') {
  const select = document.createElement("select");
  select.className = "form-select form-select-sm";
  options.forEach(opt => {
    const o = document.createElement("option");
    o.value = o.textContent = opt;
    if (val === opt) o.selected = true;
    select.appendChild(o);
  });
  return select;
}

function addMeatRow() {
  const tbody = document.getElementById('meatBody');
  const row = tbody.insertRow();
  const today = new Date().toISOString().split("T")[0];

  row.innerHTML = `
    <td></td><td></td>
    <td><input class='form-control form-control-sm'></td>
    <td><input class='form-control form-control-sm'></td>
    <td><input class='form-control form-control-sm' type='number'></td>
    <td><input class='form-control form-control-sm' type='date' value="${today}"></td>
    <td class='action-buttons'>
      <button class='btn btn-sm btn-success' onclick='saveRow(this)'><i class='fas fa-check'></i></button>
      <button class='btn btn-sm btn-secondary' onclick='cancelRow(this)'><i class='fas fa-times'></i></button>
    </td>
  `;
  row.cells[0].appendChild(createSelect(meatTypes));
  row.cells[1].appendChild(createSelect(breeds));
}

function saveRow(btn) {
  const row = btn.closest("tr");
  const values = [...row.cells].map(cell => {
    const input = cell.querySelector("input, select");
    return input ? input.value : cell.textContent.trim();
  });
  row.innerHTML = values.slice(0, 6).map(val => `<td>${val}</td>`).join('') +
    `<td class='action-buttons'>
      <button class='btn btn-sm btn-primary' onclick='editRow(this)'><i class='fas fa-pen'></i></button>
      <button class='btn btn-sm btn-danger' onclick='deleteRow(this)'><i class='fas fa-trash'></i></button>
    </td>`;
  updateSummary();
  updateChart();
}

function editRow(btn) {
  const row = btn.closest("tr");
  const data = [...row.cells].map(cell => cell.textContent.trim());
  row.innerHTML = `
    <td></td><td></td>
    <td><input class='form-control form-control-sm' value="${data[2]}"></td>
    <td><input class='form-control form-control-sm' value="${data[3]}"></td>
    <td><input class='form-control form-control-sm' type='number' value="${data[4]}"></td>
    <td><input class='form-control form-control-sm' type='date' value="${data[5]}"></td>
    <td class='action-buttons'>
      <button class='btn btn-sm btn-success' onclick='saveRow(this)'><i class='fas fa-check'></i></button>
      <button class='btn btn-sm btn-secondary' onclick='cancelRow(this)'><i class='fas fa-times'></i></button>
    </td>`;
  row.cells[0].appendChild(createSelect(meatTypes, data[0]));
  row.cells[1].appendChild(createSelect(breeds, data[1]));
}

function cancelRow(btn) {
  const row = btn.closest("tr");
  row.remove();
}

function deleteRow(btn) {
  const row = btn.closest("tr");
  row.remove();
  updateSummary();
  updateChart();
}

function updateSummary() {
  const summaryMap = {};
  document.querySelectorAll("#meatBody tr").forEach(row => {
    const meat = row.cells[0].textContent.trim();
    const breed = row.cells[1].textContent.trim();
    const weight = parseFloat(row.cells[4].textContent) || 0;
    const key = `${meat}-${breed}`;
    if (!summaryMap[key]) summaryMap[key] = { meat, breed, weight };
    else summaryMap[key].weight += weight;
  });

  const summaryBody = document.getElementById("summaryBody");
  summaryBody.innerHTML = '';
  Object.values(summaryMap).forEach(({ meat, breed, weight }) => {
    const row = summaryBody.insertRow();
    row.innerHTML = `<td>${meat}</td><td>${breed}</td><td>${tempMap[breed]}</td><td>${weight}</td>`;
  });
}

let chart = null;
function updateChart() {
  const data = {};
  document.querySelectorAll("#meatBody tr").forEach(row => {
    const meat = row.cells[0].textContent.trim();
    const weight = parseFloat(row.cells[4].textContent) || 0;
    if (!data[meat]) data[meat] = 0;
    data[meat] += weight;
  });
  const labels = Object.keys(data);
  const values = Object.values(data);
  if (chart) chart.destroy();
  chart = new Chart(document.getElementById("meatBarChart"), {
    type: "bar",
    data: {
      labels,
      datasets: [{
        label: "Quantity (kg)",
        data: values,
        backgroundColor: "#0d6efd"
      }]
    },
    options: {
      responsive: true,
      plugins: {
        title: {
          display: true,
          text: "Total Quantity by Meat Type"
        },
        legend: { display: false }
      },
      scales: {
        y: { beginAtZero: true }
      }
    }
  });
}
</script>
</body>
</html>
